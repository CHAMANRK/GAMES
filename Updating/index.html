<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Quran Knowledge Game</title>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&family=Scheherazade+New:wght@600;700&display=swap" rel="stylesheet" />

    <link rel="stylesheet" href="style.css" />
</head>
<body>

    <section id="authScreen" class="screen active">
        <div style="margin-top: 40px; text-align: center; margin-bottom: 30px;">
            <div style="font-size: 4rem; margin-bottom: 10px;">üåô</div>
            <h1 class="text-gold" style="font-family: 'Scheherazade New', serif;">Quran Game</h1>
            <p class="text-dim">Apne account se login karein</p>
        </div>

        <div id="loginButtons">
            <button class="btn btn-google btn-social" onclick="Auth.loginWithGoogle()">
                <span>G</span> Continue with Google
            </button>

            <button class="btn btn-secondary btn-social" onclick="Auth.togglePhoneForm(true)">
                <span>üì±</span> Continue with Phone
            </button>

            <button class="btn btn-secondary btn-social" onclick="Auth.toggleEmailForm(true)">
                <span>üìß</span> Continue with Email
            </button>

            <div style="margin: 20px 0; text-align: center; color: var(--text-dim); font-size: 0.8rem;">OR</div>

            <button class="btn btn-outline" onclick="Auth.loginAsGuest()">üë§ Play as Guest</button>
        </div>

        <div id="phoneForm" class="hidden glass-card" style="margin-top: 20px;">
            <h3 class="text-gold">Phone Login</h3>
            <p class="text-dim" style="font-size:0.8rem; margin-bottom:15px;">Number with Country Code (e.g. +91)</p>

            <input type="tel" id="phoneNumber" placeholder="+91 9876543210" />

            <div id="recaptcha-container" style="margin-bottom:15px; display:flex; justify-content:center;"></div>

            <button class="btn btn-primary" id="sendOtpBtn" onclick="Auth.sendOTP()">Send OTP</button>

            <div id="otpSection" class="hidden" style="margin-top:15px; border-top: 1px dashed #444; padding-top:15px;">
                <input type="number" id="otpCode" placeholder="Enter 6-digit OTP" />
                <button class="btn btn-success" onclick="Auth.verifyOTP()">Verify & Login</button>
            </div>

            <button class="btn btn-secondary" style="margin-top:10px;" onclick="Auth.togglePhoneForm(false)">‚¨ÖÔ∏è Back</button>
        </div>

        <div id="emailForm" class="hidden glass-card" style="margin-top: 20px;">
            <h3 class="text-gold">Email Login</h3>
            <input type="email" id="emailInput" placeholder="Email Address" />
            <input type="password" id="passwordInput" placeholder="Password" />

            <div style="display:flex; gap:10px;">
                <button class="btn btn-primary" onclick="Auth.loginWithEmail()">Login</button>
                <button class="btn btn-secondary" onclick="Auth.signupWithEmail()">Sign Up</button>
            </div>

            <button class="btn btn-outline" style="margin-top:10px; border:none;" onclick="Auth.toggleEmailForm(false)">‚¨ÖÔ∏è Back</button>
        </div>
    </section>

    <section id="profileSetupScreen" class="screen">
        <div class="glass-card">
            <h2 class="text-gold" style="margin-bottom: 20px;">Setup Profile</h2>
            <div class="input-group">
                <label class="input-label">Display Name</label>
                <input type="text" id="setupName" placeholder="e.g. Chaman" />
            </div>
            <div class="input-group">
                <label class="input-label">Age Group</label>
                <select id="setupAge">
                    <option>Under 15</option>
                    <option selected>15 - 24</option>
                    <option>25+</option>
                </select>
            </div>
            <div class="input-group">
                <label class="input-label">Gender (optional)</label>
                <select id="setupGender">
                    <option value="">Prefer not to say</option>
                    <option>Male</option>
                    <option>Female</option>
                </select>
            </div>
            <button class="btn btn-primary" onclick="Auth.saveProfile()">Save & Continue</button>
        </div>
    </section>

    <section id="welcomeScreen" class="screen">
        <div class="top-bar">
            <div style="display:flex; gap:8px; align-items:center;">
                <div style="font-size: 1.5rem; cursor: pointer;" onclick="showSection('settingsScreen')">‚ò∞</div>
                <button id="toggleSearchBtn" class="btn btn-outline" style="width:auto; padding:6px 10px; font-size:0.9rem;" onclick="toggleSearch()">üîé Search</button>
            </div>

            <h2 style="font-family: var(--font-quran); color: var(--primary-gold);">Quran Game</h2>
            <div class="coin-badge">üü° <span id="displayCoins">0</span></div>
        </div>

        <div class="game-grid">
            <div class="mode-card" onclick="selectMode('practice')">
                <div class="mode-icon">üéØ</div>
                <h4>Practice</h4>
            </div>
            <div class="mode-card" onclick="selectMode('timed')">
                <div class="mode-icon">‚è±Ô∏è</div>
                <h4>Time Attack</h4>
            </div>
            <div class="mode-card" onclick="selectMode('survival')">
                <div class="mode-icon">üí•</div>
                <h4>Survival</h4>
            </div>
            <div class="mode-card locked" onclick="showSection('onlineModeScreen')">
                <div class="mode-icon">‚öîÔ∏è</div>
                <h4>Online</h4>
            </div>
        </div>

        <button class="btn btn-primary" onclick="showSection('paraSelectScreen')">‚ñ∂Ô∏è Start Game</button>

        <div class="game-grid" style="margin-top: 20px;">
            <div class="glass-card" style="margin:0; padding: 15px; display: flex; align-items: center; gap: 10px; cursor: pointer;" onclick="showSection('friendsScreen')">
                <span>üë•</span> <b>Friends</b>
            </div>
            <div class="glass-card" style="margin:0; padding: 15px; display: flex; align-items: center; gap: 10px; cursor: pointer;" onclick="showSection('leaderboardScreen')">
                <span>üèÜ</span> <b>Ranks</b>
            </div>
        </div>
    </section>

    <section id="paraSelectScreen" class="screen">
        <div class="glass-card">
            <h2 class="text-gold">Configure Game</h2>
            <p class="text-dim" style="margin-bottom: 20px;">Select Para range.</p>

            <form onsubmit="startGame(); return false;" autocomplete="off">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div>
                        <label class="input-label">From Para</label>
                        <input id="fromPara" type="number" min="1" max="30" value="1" />
                    </div>
                    <div>
                        <label class="input-label">To Para</label>
                        <input id="toPara" type="number" min="1" max="30" value="30" />
                    </div>
                </div>
                <div id="selectError" class="result-box error hidden"></div>
                <button class="btn btn-primary" type="submit" style="margin-top: 20px;">Start Quiz</button>
                <button class="btn btn-secondary" type="button" onclick="showSection('welcomeScreen')">Back</button>
            </form>
        </div>
    </section>

    <section id="quizScreen" class="screen">
        <div class="progress-container">
            <span id="quizProgress" class="text-gold">Q 1</span>
            <div class="progress-track"><div class="progress-fill" style="width: 10%;"></div></div>
            <span id="timer" style="color: var(--error);"></span>
        </div>

        <div class="glass-card" style="text-align: center; min-height: 200px; display: flex; align-items: center; justify-content: center; flex-direction: column;">
            <div id="ayatText" class="ayat-display">Loading...</div>
            <div style="width: 100%; display: flex; justify-content: flex-end;">
                <button id="hintBtn" onclick="showHint()" style="background:none; border:none; color: var(--primary-gold-dim); font-size: 0.8rem; cursor: pointer;">üí° Hint <span id="hintInfo"></span></button>
            </div>
        </div>

        <form id="answerForm" onsubmit="return checkAnswer();" autocomplete="off">
            <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                <label class="input-label" style="color: #fff;">COMPULSORY</label>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <input id="user_para" type="number" placeholder="Para No." required />
                    <input id="user_page_in_para" type="number" placeholder="Page in Para" />
                </div>
            </div>

            <div style="border: 1px dashed rgba(255,255,255,0.2); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                <label class="input-label" style="color: var(--primary-gold);">OPTIONAL (Bonus)</label>
                <input id="user_surah" type="text" placeholder="Surah Name" />
                <input id="user_page" type="number" placeholder="Page Number (1-604)" />
            </div>

            <div id="quizError" class="result-box error hidden"></div>
            <div id="quizResult" class="result-box hidden"></div>
            <div id="survivalAnswer" class="result-box hidden" style="background:#fff3cd; color:#856404; text-align: left; font-size:0.9rem;"></div>

            <button class="btn btn-primary" type="submit">Submit Answer</button>
            <button type="button" class="btn btn-outline next-button hidden" onclick="nextQuestion()">Next Question ‚û°Ô∏è</button>
            <button type="button" class="btn btn-secondary" style="margin-top: 30px;" onclick="showSection('welcomeScreen')">Quit Game</button>

            <div id="scoreBoard" class="hidden"></div>
        </form>
    </section>

    <section id="resultScreen" class="screen">
        <div class="glass-card" style="text-align: center; padding-top: 40px;">
            <div style="font-size: 4rem;">üéâ</div>
            <h2 class="text-gold">Quiz Completed</h2>
            <div id="finalResult" style="margin: 30px 0; font-size: 1.1rem; line-height: 1.6;"></div>
            <button class="btn btn-primary" onclick="restartGame(false)">üîÑ Play Again</button>
            <button class="btn btn-secondary" onclick="restartGame(true)">üè† Home</button>
        </div>
    </section>

    <section id="settingsScreen" class="screen">
        <h2 style="margin-bottom: 20px;">Settings</h2>
        <div class="glass-card">
            <div style="display:flex; justify-content:space-between; margin-bottom: 20px;">
                <span>Sound Effects</span>
                <span style="color: var(--primary-gold);">ON</span>
            </div>
            <div style="display:flex; justify-content:space-between;">
                <span>Vibration</span>
                <span style="color: var(--primary-gold);">ON</span>
            </div>
        </div>
        <button class="btn btn-secondary" onclick="showSection('contactScreen')">Contact / Feedback</button>
        <button class="btn btn-secondary" onclick="showSection('adminScreen')">Admin Panel (Demo)</button>
        <button class="btn btn-outline" style="border-color: var(--error); color: var(--error); margin-top: 20px;" onclick="Auth.logoutUser()">Logout</button>
        <button class="btn btn-secondary" style="margin-top: 10px;" onclick="showSection('welcomeScreen')">Back</button>
    </section>

    <section id="friendsScreen" class="screen">
        <div style="display: flex; gap: 10px; margin-bottom: 20px;">
            <button class="btn btn-primary" style="padding: 10px; font-size: 0.9rem; margin:0;">My Friends</button>
            <button class="btn btn-secondary" style="padding: 10px; font-size: 0.9rem; margin:0;">Requests</button>
        </div>
        <div class="input-group" style="display:flex; gap:10px;">
            <input type="text" placeholder="Add friend by ID..." style="margin:0;" />
            <button class="btn btn-primary" style="width: auto; margin:0;">+</button>
        </div>
        <div style="margin-top: 20px;">
            <div class="glass-card" style="padding: 15px; display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px;">
                <div style="display:flex; align-items:center; gap:10px;">
                    <div style="width:35px; height:35px; background:#555; border-radius:50%;"></div>
                    <b>Rizwan</b>
                </div>
                <button class="btn btn-outline" style="width:auto; padding: 5px 12px; font-size: 0.8rem; margin:0;">Challenge</button>
            </div>
        </div>
        <button class="btn btn-secondary" onclick="showSection('welcomeScreen')">Back</button>
    </section>

    <section id="leaderboardScreen" class="screen">
        <h2 style="text-align: center; margin-bottom: 20px;">Top Scholars</h2>
        <div class="glass-card" style="padding: 10px;">
            <div class="leader-row rank-1">
                <div class="rank-badge">1</div>
                <div style="flex:1;"><b>Hafiz Ahmed</b></div>
                <div class="text-gold">15,400</div>
            </div>
            <div class="leader-row rank-2">
                <div class="rank-badge">2</div>
                <div style="flex:1;"><b>Sarah K.</b></div>
                <div class="text-gold">14,200</div>
            </div>
            <div class="leader-row rank-3">
                <div class="rank-badge">3</div>
                <div style="flex:1;"><b>Chaman</b></div>
                <div class="text-gold">12,450</div>
            </div>
        </div>
        <button class="btn btn-secondary" onclick="showSection('welcomeScreen')">Back</button>
    </section>

    <section id="profileScreen" class="screen">
        <div class="glass-card" style="text-align: center;">
            <div style="width: 90px; height: 90px; background: #222; border-radius: 50%; border: 3px solid var(--primary-gold); margin: 0 auto 15px; display: flex; align-items: center; justify-content: center; font-size: 2.5rem;">üë§</div>
            <h2 id="profileName" class="text-gold">Chaman</h2>
            <p class="text-dim">Student of Knowledge</p>
            <div style="margin-top: 10px; display: inline-block; padding: 4px 12px; background: rgba(212,175,55,0.2); border-radius: 12px; color: var(--primary-gold); font-size: 0.8rem;">Gold Tier</div>
        </div>
        <div class="stats-grid">
            <div class="stat-box"><div class="text-dim">Accuracy</div><div class="stat-val" style="color: var(--success);">88%</div></div>
            <div class="stat-box"><div class="text-dim">Questions</div><div class="stat-val">1,240</div></div>
            <div class="stat-box"><div class="text-dim">Best Surah</div><div class="stat-val" style="font-size: 1rem;">Al-Mulk</div></div>
            <div class="stat-box"><div class="text-dim">Weak Surah</div><div class="stat-val" style="font-size: 1rem; color: var(--error);">Al-An'am</div></div>
        </div>
        <button class="btn btn-secondary">Edit Profile</button>
        <button class="btn btn-secondary" onclick="showSection('welcomeScreen')">Back</button>
    </section>

    <section id="contactScreen" class="screen">
        <div class="glass-card">
            <h2>Raabta / Feedback</h2>
            <p class="text-dim" style="margin-bottom: 15px;">Report issues or suggest features.</p>
            <form action="https://formsubmit.co/hellochaman532@gmail.com" method="POST">
                <input type="text" name="name" placeholder="Your Name" required />
                <textarea name="message" rows="4" placeholder="Message..." style="width:100%; padding:14px; background:rgba(0,0,0,0.3); border:1px solid rgba(255,255,255,0.15); border-radius:8px; color:#fff;" required></textarea>
                <button type="submit" class="btn btn-primary">Send Message</button>
                <button type="button" class="btn btn-secondary" onclick="showSection('welcomeScreen')">Back</button>
            </form>
        </div>
    </section>

    <section id="adminScreen" class="screen admin-theme">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 20px;">
            <h2 style="color:#333;">Admin Dashboard</h2>
            <button onclick="showSection('welcomeScreen')" style="width:auto; padding:5px 10px; background:#333; color:#fff; border:none; border-radius:5px;">Exit</button>
        </div>
        <div class="glass-card">
            <h4 style="color:#555;">Recent Reports</h4>
            <table class="admin-table">
                <thead><tr><th>User</th><th>Report</th><th>Action</th></tr></thead>
                <tbody>
                    <tr><td>User_123</td><td>Wrong Ayat Text</td><td><span style="color:orange">Pending</span></td></tr>
                </tbody>
            </table>
        </div>
    </section>

    <section id="onlineModeScreen" class="screen">
        <div class="glass-card" style="text-align: center;">
            <div style="font-size: 3rem; margin-bottom: 10px;">‚öîÔ∏è</div>
            <h2>Online PvP</h2>
            <p class="text-dim">Compete with friends or random players.</p>
        </div>
        <button class="btn btn-locked">‚ö° Quick Match (Locked)</button>
        <button class="btn btn-locked">üë• Friend Duel (Locked)</button>
        <button class="btn btn-secondary" onclick="showSection('welcomeScreen')">Back</button>
    </section>

    <form id="modeForm" class="hidden">
        <input type="radio" name="quizMode" value="practice" id="radioPractice" checked>
        <input type="radio" name="quizMode" value="timed" id="radioTimed">
        <input type="radio" name="quizMode" value="survival" id="radioSurvival">
    </form>

    <div id="searchContainer" class="glass-card" style="display:none; position:fixed; top:70px; left:5%; right:5%; z-index:2000;">
        <div style="display:flex; gap:10px;">
            <input id="searchInput" type="text" placeholder="Search Quran..." style="margin:0;" />
            <button class="btn btn-primary" onclick="searchAyats()" style="width:auto; margin:0;">Go</button>
        </div>
        <button class="btn btn-secondary" onclick="toggleSearch()" style="margin-top:10px; padding:8px;">Close</button>
        <div id="searchResults" style="max-height: 300px; overflow-y: auto; margin-top: 10px;"></div>
    </div>

    <nav class="bottom-nav">
        <a href="javascript:void(0)" class="nav-item active" onclick="showSection('welcomeScreen')">
            <svg viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>Home
        </a>
        <a href="javascript:void(0)" class="nav-item" onclick="showSection('profileScreen')">
            <svg viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>Profile
        </a>
        <a href="javascript:void(0)" class="nav-item" onclick="showSection('friendsScreen')">
            <svg viewBox="0 0 24 24"><path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/></svg>Friends
        </a>
        <a href="javascript:void(0)" class="nav-item" onclick="showSection('settingsScreen')">
            <svg viewBox="0 0 24 24"><path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.3 1.02c-.22.09-.47 0-.59-.22L2.71 7.87c-.11-.2-.06-.47.12-.61L4.86 5.68c-.05-.3-.07-.62-.07-.94 0-.33.02-.64.06-.94L2.9 1.62C2.74 1.37 2.86 1.04 3.12.88l3.32-1.92c.2-.12.47-.07.61.12l1.58 2.03c.3-.04.61-.06.94-.06.32 0 .64.02.94.07l1.58-2.03c.14-.18.41-.23.61-.12l3.32 1.92c.25.14.37.47.25.73l-1.58 2.03c.04.3.06.61.06.94 0 .33-.02.64-.06.94l2.03 1.58c.18.14.23.41.12.61l-1.92 3.32c-.12.22-.37.29-.59.22l-2.39-.96c-.5.38-1.03.7-1.62.94l-.36 2.54c-.04.24-.24.41-.48.41h-3.84c-.24 0-.43-.17-.47-.41l-.36-2.54c-.59-.24-1.13-.57-1.62-.94l-2.39.96c-.22.09-.47 0-.59-.22l-1.92-3.32c-.11-.2-.06-.47.12-.61l2.03-1.58z"/></svg>Settings
        </a>
    </nav>

    <!-- Scripts: storage first, then auth module, then app scripts -->
    <script src="storage.js"></script>
    <script type="module" src="auth.js"></script>
    <script src="data.js"></script>
    <script src="ui.js"></script>
    <script src="search.js"></script>
    <script src="game.js"></script>

    <!-- Temporary debug helper (remove in production) -->
    <script src="debug.js"></script>
</body>
</html>