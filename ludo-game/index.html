<!-- 
Developed By CHAMAN ("Najeef")
Email : hellochaman532@gmail.com
Instagram : @with_chaman
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/main.css?version=<?=time()?>" type="text/css">
    <link rel="icon" href="assets/img/dice.png">
    <script src="assets/js/jquery-3.6.0.min.js"></script>
    <!-- Import only working scripts -->
    <script src="assets/js/logic.js?version=<?=time()?>"></script>
    <script src="assets/js/timer.js?version=<?=time()?>"></script>
    <title>Ludo Board Game v3.0</title>
    <style>
        /* Responsive improvements for desktop/mobile */
        .ludo-board, .white-box, .player-room, .scoreboard {
            box-sizing: border-box;
        }
        .ludo-board {
            width: 100%;
            max-width: 600px;
            margin: auto;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }
        .step, .red-home, .green-home, .yellow-home, .blue-home, .winner-home {
            min-width: 32px;
            min-height: 32px;
        }
        @media (max-width: 700px) {
            .ludo-board { max-width: 99vw; }
            .step, .red-home, .green-home, .yellow-home, .blue-home, .winner-home {
                min-width: 24px; min-height: 24px;
            }
            .scoreboard { font-size: 1rem; }
            .gameover h1 { font-size: 1.2em; }
        }
        .playerlist, .scoreboard { display: flex; align-items: center; gap: 8px; }
        button, input[type="text"] {
            touch-action: manipulation;
        }
        /* For admin panel mobile scroll */
        #adminPanel { overflow-y: auto; max-height: 95vh; }
    </style>
</head>
<body>
    <!-- GAME OVER SCREEN -->
    <div class="gameover" style="display:none">
        <div class="scoreboard">
            <h1>Game Over</h1>
            <div class="playerlist"><div class="player movered1"></div><div id="r1">Red Player</div><img src="assets/img/crown1.png" class="icon2"/></div>
            <div class="playerlist"><div class="player movegreen1"></div><div id="r2">Green Player</div><img src="assets/img/crown2.png" class="icon2"/></div>
            <div class="playerlist"><div class="player moveyellow1"></div><div id="r3">Yellow Player</div><img src="assets/img/crown3.png" class="icon2"/></div>
            <div class="playerlist"><div class="player moveblue1"></div><div id="r4">Blue Player</div></div>
        </div>
    </div>
    <!-- WELCOME / LOBBY SCREEN -->
    <div class="welcome" style="display:block">
        <div class="menu">
            <div class="lobby" style="display:block;">
                <h2 class="super-center">Play Ludo Offline</h2>
                <div class="control3">
                    <!-- Fixed player button IDs to match logic.js -->
                    <div class="lb"><button id="movered1" class="player playersel bg-red"></button>&nbsp;&nbsp;<span id="red_player_name" class="f"><input type="text" class="cun"><button class="bot botoff"></button></span></div>
                    <div class="lb"><button id="movegreen1" class="player playersel bg-green"></button>&nbsp;&nbsp;<span id="green_player_name" class="f"><input type="text" class="cun"><button class="bot botoff"></button></span></div>
                    <div class="lb"><button id="moveyellow1" class="player playersel bg-yellow"></button>&nbsp;&nbsp;<span id="yellow_player_name" class="f"><input type="text" class="cun"><button class="bot botoff"></button></span></div>
                    <div class="lb"><button id="moveblue1" class="player playersel bg-blue"></button>&nbsp;&nbsp;<span id="blue_player_name" class="f"><input type="text" class="cun"><button class="bot botoff"></button></span></div>
                </div>
                <div class="super-center">
                    <button id="start_btn">Start Game</button>
                    <button id="loading_btn" style="display:none" disabled>
                        <div class="spinner-border text-danger" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                    </button>
                </div>
            </div>
            <div>
                <span>KEYBOARD CONTROLS</span> <br>
                <kbd>Space</kbd> for dice & <kbd>1</kbd> <kbd>2</kbd> <kbd>3</kbd> <kbd>4</kbd> for players
            </div>
            <hr>
            <div class="super-center">
                Developed By Chaman /&nbsp;<a href="https://www.youtube.com/@muhammadrehanraza7007" class="text-decoration-none" target="_blank">Follow</a>
            </div>
        </div>
    </div>
    <!-- MAIN BOARD -->
    <main class="container">
        <div class="ludo-board">
            <!-- RED HOME -->
            <div class="red-home red-home-bg bg-red super-center">
                <div class="white-box super-center">
                    <div class="player-room"></div>
                </div>
            </div>
            <div class="step"></div>
            <div class="step"></div>
            <div class="step"></div>
            <!-- GREEN HOME -->
            <div class="green-home green-home-bg bg-green super-center">
                <div class="white-box super-center">
                    <div class="player-room"></div>
                </div>
            </div>
            <div class="step"></div>
            <div class="step bg-green"></div>
            <div class="step bg-green"></div>
            <div class="step red-stop"></div>
            <div class="step bg-green"></div>
            <div class="step"></div>
            <div class="step"></div>
            <div class="step bg-green"></div>
            <div class="step"></div>
            <div class="step"></div>
            <div class="step bg-green"></div>
            <div class="step"></div>
            <div class="step"></div>
            <div class="step bg-green"></div>
            <div class="step"></div>
            <div class="step"></div>
            <div class="step bg-red"></div>
            <div class="step"></div>
            <div class="step"></div>
            <div class="step"></div>
            <div class="step"></div>
            <!-- WINNER HOME -->
            <div class="winner-home">
                <div class="rwh stack"></div>
                <div class="gwh stack"></div>
                <div class="bwh stack"></div>
                <div class="ywh stack"></div>
            </div>
            <div class="step"></div>
            <div class="step"></div>
            <div class="step"></div>
            <div class="step green-stop"></div>
            <div class="step"></div>
            <div class="step"></div>
            <div class="step"></div>
            <div class="step bg-red"></div>
            <div class="step bg-red"></div>
            <div class="step bg-red"></div>
            <div class="step bg-red"></div>
            <div class="step bg-red"></div>
            <div class="step bg-yellow"></div>
            <div class="step bg-yellow"></div>
            <div class="step bg-yellow"></div>
            <div class="step bg-yellow"></div>
            <div class="step bg-yellow"></div>
            <div class="step"></div>
            <div class="step"></div>
            <div class="step"></div>
            <div class="step blue-stop"></div>
            <div class="step"></div>
            <div class="step"></div>
            <div class="step"></div>
            <div class="step"></div>
            <div class="step"></div>
            <div class="step"></div>
            <div class="step"></div>
            <div class="step bg-yellow"></div>
            <div class="step"></div>
            <!-- BLUE HOME -->
            <div class="blue-home bg-blue blue-home-bg super-center">
                <div class="white-box super-center">
                    <div class="player-room"></div>
                </div>
            </div>
            <div class="step"></div>
            <div class="step bg-blue"></div>
            <div class="step"></div>
            <!-- YELLOW HOME -->
            <div class="yellow-home yellow-home-bg bg-yellow super-center">
                <div class="white-box super-center">
                    <div class="player-room"></div>
                </div>
            </div>
            <div class="step"></div>
            <div class="step bg-blue"></div>
            <div class="step"></div>
            <div class="step"></div>
            <div class="step bg-blue"></div>
            <div class="step"></div>
            <div class="step"></div>
            <div class="step bg-blue"></div>
            <div class="step yellow-stop"></div>
            <div class="step bg-blue"></div>
            <div class="step bg-blue"></div>
            <div class="step"></div>
            <div class="step"></div>
            <div class="step"></div>
            <div class="step"></div>
        </div>
        <!-- CONTROLLER PANEL -->
        <div class="test_controller">
            <div class="topbar">
                <div class="timer"><img src="assets/img/clock.png" class="icon" /> <span id="watch">00:00:00</span></div>
                <div class="timer">Turn : <span class="current_turn">...</span><span id="dice_value"></span></div>
            </div>
            <button id="dice" class="d0"></button>
            <div class="red_control control">
                <button id="movered1" class="player movered1 bg-red"></button>
                <button id="movered2" class="player movered2 bg-red"></button>
                <button id="movered3" class="player movered3 bg-red"></button>
                <button id="movered4" class="player movered4 bg-red"></button>
            </div>
            <div class="green_control control">
                <button id="movegreen1" class="player movegreen1 bg-green"></button>
                <button id="movegreen2" class="player movegreen2 bg-green"></button>
                <button id="movegreen3" class="player movegreen3 bg-green"></button>
                <button id="movegreen4" class="player movegreen4 bg-green"></button>
            </div>
            <div class="yellow_control control">
                <button id="moveyellow1" class="player moveyellow1 bg-yellow"></button>
                <button id="moveyellow2" class="player moveyellow2 bg-yellow"></button>
                <button id="moveyellow3" class="player moveyellow3 bg-yellow"></button>
                <button id="moveyellow4" class="player moveyellow4 bg-yellow"></button>
            </div>
            <div class="blue_control control">
                <button id="moveblue1" class="player moveblue1 bg-blue"></button>
                <button id="moveblue2" class="player moveblue2 bg-blue"></button>
                <button id="moveblue3" class="player moveblue3 bg-blue"></button>
                <button id="moveblue4" class="player moveblue4 bg-blue"></button>
            </div>
            <h1 class="red_control rc_name"></h1>
            <h1 class="green_control gc_name"></h1>
            <h1 class="yellow_control yc_name"></h1>
            <h1 class="blue_control bc_name"></h1>
        </div>
    </main>
    <!-- CUSTOM RULES & ADMIN PANEL -->
    <button id="customRulesBtn" style="position:fixed;bottom:28px;left:25px;z-index:9000;background:#3887be;color:#fff;border-radius:8px;padding:8px 16px;font-size:16px;border:none;box-shadow:0 2px 8px #0002;cursor:pointer;opacity:0.88;">Rules</button>
    <div id="flashcard" style="display:none;position:fixed;bottom:70px;left:25px;background:#fff;color:#222;border:2px solid #08a;border-radius:10px;padding:16px 30px;z-index:8888;box-shadow:0 2px 12px #0003;font-size:18px;min-width:300px;">
        <strong>Custom Rules:</strong>
        <div id="rules-list"></div>
        <small style="font-size:13px;">(Click checkboxes to toggle)</small>
    </div>
    <!-- ADMIN PANEL -->
    <div id="adminPanel" style="display:none;position:fixed;top:20px;right:20px;width:350px;background:#222;color:#fff;border:2px solid #8800ff;border-radius:12px;z-index:9999;box-shadow:0 4px 24px #0006;padding:22px;">
        <button id="closeAdminBtn" style="position:absolute;top:5px;right:8px;background:#8800ff;color:#fff;border:none;border-radius:4px;cursor:pointer;font-size:16px;padding:2px 8px;">✕</button>
        <h3>Secret Admin Panel</h3>
        <div>
            <label>Manual Dice Control:</label><br>
            <select id="dicePlayerSelect">
                <option value="RED">Red</option>
                <option value="GREEN">Green</option>
                <option value="YELLOW">Yellow</option>
                <option value="BLUE">Blue</option>
            </select>
            <input type="number" min="1" max="6" id="diceValueInput" placeholder="Dice value (1-6)">
            <button onclick="adminSetDice()">Set Dice</button>
        </div>
        <hr>
        <div>
            <label>Auto Win Mode:</label>
            <select id="autoWinSelect">
                <option value="">Off</option>
                <option value="RED">Red</option>
                <option value="GREEN">Green</option>
                <option value="YELLOW">Yellow</option>
                <option value="BLUE">Blue</option>
            </select>
            <button onclick="adminSetAutoWin()">Apply</button>
        </div>
        <hr>
        <div>
            <label>Invincibility:</label>
            <select id="invinciblePlayerSelect">
                <option value="RED">Red</option>
                <option value="GREEN">Green</option>
                <option value="YELLOW">Yellow</option>
                <option value="BLUE">Blue</option>
            </select>
            <input type="number" min="1" max="4" id="invincibleTokenInput" placeholder="Token #">
            <button onclick="adminSetInvincible()">Set</button>
        </div>
        <hr>
        <div>
            <label>Teleport Token:</label>
            <select id="teleportPlayerSelect">
                <option value="RED">Red</option>
                <option value="GREEN">Green</option>
                <option value="YELLOW">Yellow</option>
                <option value="BLUE">Blue</option>
            </select>
            <input type="number" min="1" max="4" id="teleportTokenInput" placeholder="Token #">
            <input type="number" min="0" max="224" id="teleportCellInput" placeholder="Cell # (0-224)">
            <button onclick="adminTeleportToken()">Teleport</button>
        </div>
        <hr>
        <div>
            <label>Freeze Player:</label>
            <select id="freezePlayerSelect">
                <option value="RED">Red</option>
                <option value="GREEN">Green</option>
                <option value="YELLOW">Yellow</option>
                <option value="BLUE">Blue</option>
            </select>
            <button onclick="adminFreezePlayer()">Freeze</button>
            <button onclick="adminUnfreezePlayer()">Unfreeze</button>
        </div>
        <hr>
        <div>
            <button onclick="showConfetti()">Show Confetti</button>
            <button onclick="adminTaunt()">Taunt</button>
        </div>
    </div>
    <canvas id="confetti-canvas" style="display:none;pointer-events:none;position:fixed;left:0;top:0;width:100vw;height:100vh;z-index:999999;"></canvas>
    <script>
        // --- Custom Rules Logic ---
        window.customRules = [
            {name:"only1opens", enabled:false},
            {name:"noKills", enabled:false},
            {name:"mustKillHome", enabled:false}
        ];
        const ruleNames = [
            "Only 1 opens the token",
            "Don't allow kills",
            "Must kill before reaching home"
        ];
        function updateRulesList() {
            let html = '';
            for(let i=0; i<window.customRules.length; i++) {
                html += `<label><input type="checkbox" ${window.customRules[i].enabled ? "checked" : ""} 
                    onclick="toggleRule(${i})"> ${ruleNames[i]}</label><br>`;
            }
            document.getElementById('rules-list').innerHTML = html;
        }
        function toggleRule(idx) {
            if(window.customRules && window.customRules[idx]) {
                window.customRules[idx].enabled = !window.customRules[idx].enabled;
                updateRulesList();
            }
        }
        document.getElementById('customRulesBtn').onclick = function(){
            flashcardVisible = !flashcardVisible;
            document.getElementById('flashcard').style.display = flashcardVisible ? 'block' : 'none';
            updateRulesList();
        }
        let flashcardVisible = false;

        // --- Confetti ---
        function showConfetti() {
            const canvas = document.getElementById('confetti-canvas');
            canvas.style.display = 'block';
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth; canvas.height = window.innerHeight;
            let confs = [];
            for (let i=0; i<120; i++) confs.push({
                x: Math.random()*canvas.width,
                y: Math.random()*canvas.height,
                r: Math.random()*8+4,
                c: `hsl(${Math.random()*360},90%,60%)`,
                v: Math.random()*2+2
            });
            let time = 0;
            function animate() {
                ctx.clearRect(0,0,canvas.width,canvas.height);
                for(let c of confs){
                    ctx.beginPath();
                    ctx.arc(c.x, c.y, c.r, 0, 2*Math.PI);
                    ctx.fillStyle = c.c;
                    ctx.fill();
                    c.y += c.v;
                    if(c.y > canvas.height) c.y = -c.r;
                }
                time++;
                if(time < 70) requestAnimationFrame(animate);
                else canvas.style.display = 'none';
            }
            animate();
        }
        // --- Taunt ---
        function adminTaunt() {
            alert("👑 Admin says: You can't beat me!");
        }

        // --- Admin Panel (dice hold for 5s) ---
        let diceHoldTimer = null;
        function setupDiceHold() {
            const diceBtn = document.getElementById('dice');
            if (!diceBtn) return;
            diceBtn.addEventListener('mousedown', function() {
                diceHoldTimer = setTimeout(showAdminPanel, 5000);
            });
            diceBtn.addEventListener('mouseup', function() {
                if (diceHoldTimer) clearTimeout(diceHoldTimer);
            });
            diceBtn.addEventListener('mouseleave', function() {
                if (diceHoldTimer) clearTimeout(diceHoldTimer);
            });
            diceBtn.addEventListener('touchstart', function() {
                diceHoldTimer = setTimeout(showAdminPanel, 5000);
            });
            diceBtn.addEventListener('touchend', function() {
                if (diceHoldTimer) clearTimeout(diceHoldTimer);
            });
            diceBtn.addEventListener('touchcancel', function() {
                if (diceHoldTimer) clearTimeout(diceHoldTimer);
            });
        }
        function showAdminPanel() {
            document.getElementById('adminPanel').style.display = 'block';
        }
        function hideAdminPanel() {
            document.getElementById('adminPanel').style.display = 'none';
        }
        document.getElementById('closeAdminBtn').onclick = hideAdminPanel;

        window.onload = function() {
            updateRulesList();
            setupDiceHold();
        }
    </script>
</body>
</html>
