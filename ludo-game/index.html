<!-- Developed By CHAMAN ("Najeef") -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/main.css?version=<?=time()?>" type="text/css">
    <link rel="icon" href="assets/img/dice.png">
    <script src="assets/js/jquery-3.6.0.min.js"></script>
    <script src="assets/js/players.js?version=<?=time()?>"></script>
    <title>Ludo Board Game v3.0</title>
</head>
<body>
    <!-- ...[Your original code for welcome screen, lobby, board, controls, etc.]... -->

    <!-- Custom Rules Button (visible, bottom left) -->
    <button id="customRulesBtn" style="position:fixed;bottom:28px;left:25px;z-index:9000;background:#3887be;color:#fff;border-radius:8px;padding:8px 16px;font-size:16px;border:none;box-shadow:0 2px 8px #0002;cursor:pointer;opacity:0.88;">Rules</button>

    <!-- Custom rules flashcard -->
    <div id="flashcard" style="display:none;position:fixed;bottom:70px;left:25px;background:#fff;color:#222;border:2px solid #08a;border-radius:10px;padding:16px 30px;z-index:8888;box-shadow:0 2px 12px #0003;font-size:18px;min-width:300px;">
      <strong>Custom Rules:</strong>
      <div id="rules-list"></div>
      <small style="font-size:13px;">(Click checkboxes to toggle)</small>
    </div>

    <!-- Secret Admin Panel (hidden by default, open on dice hold) -->
    <div id="adminPanel" style="display:none;position:fixed;top:20px;right:20px;width:350px;background:#222;color:#fff;border:2px solid #8800ff;border-radius:12px;z-index:9999;box-shadow:0 4px 24px #0006;padding:22px;">
      <button id="closeAdminBtn" style="position:absolute;top:5px;right:8px;background:#8800ff;color:#fff;border:none;border-radius:4px;cursor:pointer;font-size:16px;padding:2px 8px;">âœ•</button>
      <h3>Secret Admin Panel</h3>
      <div>
        <label>Manual Dice Control:</label><br>
        <select id="dicePlayerSelect">
          <option value="RED">Red</option>
          <option value="GREEN">Green</option>
          <option value="YELLOW">Yellow</option>
          <option value="BLUE">Blue</option>
        </select>
        <input type="number" min="1" max="6" id="diceValueInput" placeholder="Dice value (1-6)">
        <button onclick="adminSetDice()">Set Dice</button>
      </div>
      <hr>
      <div>
        <label>Auto Win Mode:</label>
        <select id="autoWinSelect">
          <option value="">Off</option>
          <option value="RED">Red</option>
          <option value="GREEN">Green</option>
          <option value="YELLOW">Yellow</option>
          <option value="BLUE">Blue</option>
        </select>
        <button onclick="adminSetAutoWin()">Apply</button>
      </div>
      <hr>
      <div>
        <label>Invincibility:</label>
        <select id="invinciblePlayerSelect">
          <option value="RED">Red</option>
          <option value="GREEN">Green</option>
          <option value="YELLOW">Yellow</option>
          <option value="BLUE">Blue</option>
        </select>
        <input type="number" min="1" max="4" id="invincibleTokenInput" placeholder="Token #">
        <button onclick="adminSetInvincible()">Set</button>
      </div>
      <hr>
      <div>
        <label>Teleport Token:</label>
        <select id="teleportPlayerSelect">
          <option value="RED">Red</option>
          <option value="GREEN">Green</option>
          <option value="YELLOW">Yellow</option>
          <option value="BLUE">Blue</option>
        </select>
        <input type="number" min="1" max="4" id="teleportTokenInput" placeholder="Token #">
        <input type="number" min="0" max="224" id="teleportCellInput" placeholder="Cell # (0-224)">
        <button onclick="adminTeleportToken()">Teleport</button>
      </div>
      <hr>
      <div>
        <label>Freeze Player:</label>
        <select id="freezePlayerSelect">
          <option value="RED">Red</option>
          <option value="GREEN">Green</option>
          <option value="YELLOW">Yellow</option>
          <option value="BLUE">Blue</option>
        </select>
        <button onclick="adminFreezePlayer()">Freeze</button>
        <button onclick="adminUnfreezePlayer()">Unfreeze</button>
      </div>
      <hr>
      <div>
        <button onclick="showConfetti()">Show Confetti</button>
        <button onclick="adminTaunt()">Taunt</button>
      </div>
    </div>
    <canvas id="confetti-canvas" style="display:none;pointer-events:none;position:fixed;left:0;top:0;width:100vw;height:100vh;z-index:999999;"></canvas>
    
    <!-- ...[Your existing scripts]... -->
    <script src="assets/js/timer.js?version=<?=time()?>"></script>
    <script src="assets/js/logic.js?version=<?=time()?>"></script>
    <script src="assets/js/autorun.js?version=<?=time()?>"></script>

    <script>
      // --- Custom Rules Logic ---
      window.customRules = [
        {name:"only1opens", enabled:false},
        {name:"noKills", enabled:false},
        {name:"mustKillHome", enabled:false}
      ];
      function updateRulesList() {
        const ruleNames = [
          "Only 1 opens the token",
          "Don't allow kills",
          "Must kill before reaching home"
        ];
        let html = '';
        for(let i=0; i<window.customRules.length; i++) {
          html += `<label><input type="checkbox" ${window.customRules[i].enabled ? "checked" : ""} onclick="toggleRule(${i+1})"> ${ruleNames[i]}</label><br>`;
        }
        document.getElementById('rules-list').innerHTML = html;
      }
      function toggleRule(idx) {
        if(window.customRules && window.customRules[idx-1]) {
          window.customRules[idx-1].enabled = !window.customRules[idx-1].enabled;
          updateRulesList();
        }
      }
      document.getElementById('customRulesBtn').onclick = function(){ 
        flashcardVisible = !flashcardVisible; 
        document.getElementById('flashcard').style.display = flashcardVisible ? 'block' : 'none'; 
        updateRulesList();
      }
      let flashcardVisible = false;

      // --- Confetti ---
      function showConfetti() {
        const canvas = document.getElementById('confetti-canvas');
        canvas.style.display = 'block';
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;
        let confs = [];
        for (let i=0; i<120; i++) confs.push({
          x: Math.random()*canvas.width,
          y: Math.random()*canvas.height,
          r: Math.random()*8+4,
          c: `hsl(${Math.random()*360},90%,60%)`,
          v: Math.random()*2+2
        });
        let time = 0;
        function animate() {
          ctx.clearRect(0,0,canvas.width,canvas.height);
          for(let c of confs){
            ctx.beginPath();
            ctx.arc(c.x, c.y, c.r, 0, 2*Math.PI);
            ctx.fillStyle = c.c;
            ctx.fill();
            c.y += c.v;
            if(c.y > canvas.height) c.y = -c.r;
          }
          time++;
          if(time < 70) requestAnimationFrame(animate);
          else canvas.style.display = 'none';
        }
        animate();
      }
      // --- Taunt ---
      function adminTaunt() {
        alert("ðŸ‘‘ Admin says: You can't beat me!");
      }

      // --- Admin Panel (dice hold for 5s) ---
      let diceHoldTimer = null;
      function setupDiceHold() {
        const diceBtn = document.getElementById('dice');
        if (!diceBtn) return;
        diceBtn.addEventListener('mousedown', function() {
          diceHoldTimer = setTimeout(showAdminPanel, 5000);
        });
        diceBtn.addEventListener('mouseup', function() {
          if (diceHoldTimer) clearTimeout(diceHoldTimer);
        });
        diceBtn.addEventListener('mouseleave', function() {
          if (diceHoldTimer) clearTimeout(diceHoldTimer);
        });
        diceBtn.addEventListener('touchstart', function() {
          diceHoldTimer = setTimeout(showAdminPanel, 5000);
        });
        diceBtn.addEventListener('touchend', function() {
          if (diceHoldTimer) clearTimeout(diceHoldTimer);
        });
        diceBtn.addEventListener('touchcancel', function() {
          if (diceHoldTimer) clearTimeout(diceHoldTimer);
        });
      }
      function showAdminPanel() {
        document.getElementById('adminPanel').style.display = 'block';
      }
      function hideAdminPanel() {
        document.getElementById('adminPanel').style.display = 'none';
      }
      document.getElementById('closeAdminBtn').onclick = hideAdminPanel;

      window.onload = function() {
        updateRulesList();
        setupDiceHold();
      }
    </script>
</body>
</html>
