<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Money Manager v2.0 - Chaman Hub</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
</head>
<body>

    <div id="loading-overlay">
        <div class="spinner"></div>
        <p>Syncing Data...</p>
    </div>

    <!-- AUTH -->
    <div id="auth-view" class="hidden">
        <div class="login-card">
            <div class="login-logo">üí∞</div>
            <h1>MONEY MANAGER</h1>
            <p>Smart expense tracking & budget management</p>
            <button onclick="window.loginGoogle()" class="google-btn">
                <span class="material-icons-round">login</span> Login with Google
            </button>
        </div>
    </div>

    <!-- APP -->
    <div id="app-view" class="hidden">

        <header>
            <div class="user-info">
                <h2 id="user-name">Welcome</h2>
            </div>
            <div class="header-actions">
                <button onclick="window.toggleTheme()" class="icon-btn" id="theme-btn" title="Toggle Theme">
                    <span class="material-icons-round">light_mode</span>
                </button>
                <button onclick="window.openModal('settings-modal')" class="icon-btn" title="Settings">
                    <span class="material-icons-round">settings</span>
                </button>
                <button onclick="window.logout()" class="icon-btn" title="Logout">
                    <span class="material-icons-round">logout</span>
                </button>
            </div>
        </header>

        <!-- HERO TOTAL -->
        <section class="hero-total">
            <p class="hero-label">Total Balance</p>
            <h1 id="grand-total" class="hero-amount">‚Çπ0</h1>
            <div class="hero-breakdown">
                <span>üë§ Mera: <strong id="my-total">‚Çπ0</strong></span>
                <span class="hero-divider">|</span>
                <span>üë• Friends: <strong id="friends-total">‚Çπ0</strong></span>
            </div>
        </section>

        <!-- WALLETS -->
        <section class="wallets-section">
            <div class="section-header">
                <span>Accounts & Friends</span>
                <span class="material-icons-round add-icon" onclick="window.promptPassword('add-wallet')" title="Add Wallet">add_circle</span>
            </div>
            <div id="wallets-list" class="wallets-scroll"></div>
        </section>

        <!-- SEARCH -->
        <div class="search-bar-wrap">
            <span class="material-icons-round">search</span>
            <input type="text" id="search-input" placeholder="Search transactions..." oninput="window.applyAllFilters()">
        </div>

        <!-- FILTER CHIPS -->
        <div class="filter-row">
            <button class="filter-chip active" onclick="window.setTxFilter('all', this)">All</button>
            <button class="filter-chip" onclick="window.setTxFilter('deposit', this)">üìà Income</button>
            <button class="filter-chip" onclick="window.setTxFilter('expense', this)">üìâ Expense</button>
            <button class="filter-chip" onclick="window.setTxFilter('transfer', this)">üîÅ Transfer</button>
            <button class="filter-chip" onclick="window.setTxFilter('settlement', this)">ü§ù Settlement</button>
        </div>

        <!-- MONTH FILTER -->
        <div class="month-filter-wrap">
            <span class="material-icons-round">calendar_month</span>
            <select id="month-filter" onchange="window.applyAllFilters()">
                <option value="">All Time</option>
            </select>
        </div>

        <!-- TRANSACTIONS -->
        <section class="transactions-section">
            <div class="section-header">
                <span>Recent Activity</span>
                <span id="tx-count" class="tx-count-badge">0</span>
            </div>
            <div id="transactions-list">
                <div class="empty-state">
                    <span class="material-icons-round" style="font-size:3em;color:#444">receipt_long</span>
                    <p>No transactions yet</p>
                </div>
            </div>
        </section>

        <div style="height: 90px"></div>

        <!-- FAB -->
        <button class="fab" onclick="window.openModal('transaction-modal')" title="Add Transaction">
            <span class="material-icons-round">add</span>
        </button>

    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MODALS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

    <!-- TRANSACTION MODAL -->
    <div id="transaction-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>New Transaction</h3>
                <span class="material-icons-round close-btn" onclick="window.closeModal('transaction-modal')">close</span>
            </div>

            <div class="type-tabs">
                <button class="type-tab active" id="tab-deposit" onclick="window.setTxType('deposit', this)">
                    <span class="material-icons-round">arrow_downward</span><br>Income
                </button>
                <button class="type-tab" id="tab-expense" onclick="window.setTxType('expense', this)">
                    <span class="material-icons-round">arrow_upward</span><br>Expense
                </button>
                <button class="type-tab" id="tab-transfer" onclick="window.setTxType('transfer', this)">
                    <span class="material-icons-round">swap_horiz</span><br>Transfer
                </button>
                <button class="type-tab" id="tab-settlement" onclick="window.setTxType('settlement', this)">
                    <span class="material-icons-round">handshake</span><br>Settle
                </button>
            </div>

            <select id="tx-wallet" required>
                <option value="" disabled selected>Select Account</option>
            </select>

            <div id="transfer-to-wrap" class="hidden">
                <select id="tx-wallet-to">
                    <option value="" disabled selected>Transfer To</option>
                </select>
            </div>

            <div id="settlement-wrap" class="hidden">
                <select id="settlement-reason">
                    <option value="udhar">üí∏ Udhar Wapas (Loan Return)</option>
                    <option value="diya">üéÅ Apne Se Diya (Gift)</option>
                    <option value="split">üçΩÔ∏è Bill Split</option>
                    <option value="kiraya">üè† Kiraya</option>
                    <option value="other">üìå Other</option>
                </select>
            </div>

            <input type="number" id="tx-amount" placeholder="Amount (‚Çπ)" min="1" required>
            <input type="text" id="tx-desc" placeholder="Note (e.g. Rent, Food)">

            <div id="category-wrap">
                <div class="cat-row">
                    <select id="tx-category" style="flex:1">
                        <option value="">Category (Optional)</option>
                    </select>
                    <button class="add-cat-inline-btn" onclick="window.openModal('add-category-modal')" title="Add Category">
                        <span class="material-icons-round">add_circle</span>
                    </button>
                </div>
            </div>

            <div class="modal-actions">
                <button onclick="window.closeModal('transaction-modal')" class="btn-cancel">Cancel</button>
                <button onclick="window.saveTransaction()" class="btn-save">Save</button>
            </div>
        </div>
    </div>

    <!-- ADD WALLET MODAL -->
    <div id="add-wallet-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add Account / Friend</h3>
                <span class="material-icons-round close-btn" onclick="window.closeModal('add-wallet-modal')">close</span>
            </div>
            <div class="wallet-type-row">
                <label class="radio-label">
                    <input type="radio" name="wallet-type" value="owner" checked> üë§ Mine
                </label>
                <label class="radio-label">
                    <input type="radio" name="wallet-type" value="friend"> üë• Friend
                </label>
            </div>
            <input type="text" id="new-wallet-name" placeholder="Name (e.g. Vip, My Bank)">
            <input type="number" id="new-wallet-bal" placeholder="Initial Balance (‚Çπ)" min="0">
            <div class="modal-actions">
                <button onclick="window.closeModal('add-wallet-modal')" class="btn-cancel">Cancel</button>
                <button onclick="window.addWallet()" class="btn-save">Create</button>
            </div>
        </div>
    </div>

    <!-- WALLET DETAIL MODAL -->
    <div id="wallet-detail-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="wallet-detail-name">Wallet</h3>
                <span class="material-icons-round close-btn" onclick="window.closeModal('wallet-detail-modal')">close</span>
            </div>
            <div class="wallet-detail-balance" id="wallet-detail-bal">‚Çπ0</div>
            <div id="wallet-lock-info" class="lock-info-badge hidden"></div>
            <div class="wallet-detail-actions">
                <button onclick="window.promptPassword('edit-wallet')" class="detail-btn">
                    <span class="material-icons-round">edit</span> Edit
                </button>
                <button onclick="window.promptPassword('lock-money')" class="detail-btn">
                    <span class="material-icons-round">lock</span> Lock Money
                </button>
                <button onclick="window.promptPassword('delete-wallet')" class="detail-btn danger">
                    <span class="material-icons-round">delete</span> Delete
                </button>
            </div>
        </div>
    </div>

    <!-- EDIT WALLET MODAL -->
    <div id="edit-wallet-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Wallet</h3>
                <span class="material-icons-round close-btn" onclick="window.closeModal('edit-wallet-modal')">close</span>
            </div>
            <input type="text" id="edit-wallet-name" placeholder="Name">
            <input type="number" id="edit-wallet-bal" placeholder="Balance (‚Çπ)">
            <input type="hidden" id="edit-wallet-id">
            <div class="modal-actions">
                <button onclick="window.closeModal('edit-wallet-modal')" class="btn-cancel">Cancel</button>
                <button onclick="window.saveWalletEdit()" class="btn-save">Save</button>
            </div>
        </div>
    </div>

    <!-- LOCK MONEY MODAL -->
    <div id="lock-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üîí Lock Money</h3>
                <span class="material-icons-round close-btn" onclick="window.closeModal('lock-modal')">close</span>
            </div>
            <p class="info-text">Locked amount stays hidden. You'll get alerts when balance is close to the lock.</p>
            <input type="hidden" id="lock-wallet-id">
            <input type="number" id="lock-amount" placeholder="Amount to Lock (‚Çπ)" min="0">
            <input type="text" id="lock-reason" placeholder="Reason (e.g. Bike repair, Emergency fund)">
            <input type="number" id="lock-alert-threshold" placeholder="Alert when available balance below (‚Çπ)">
            <div class="modal-actions">
                <button onclick="window.removeLock()" class="btn-cancel">Remove Lock</button>
                <button onclick="window.saveLock()" class="btn-save">Lock It üîí</button>
            </div>
        </div>
    </div>

    <!-- ADD CATEGORY MODAL -->
    <div id="add-category-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add Category</h3>
                <span class="material-icons-round close-btn" onclick="window.closeModal('add-category-modal')">close</span>
            </div>
            <input type="text" id="new-cat-emoji" placeholder="Emoji (e.g. üè†)" maxlength="4">
            <input type="text" id="new-cat-name" placeholder="Category Name (e.g. Kiraya)">
            <div class="modal-actions">
                <button onclick="window.closeModal('add-category-modal')" class="btn-cancel">Cancel</button>
                <button onclick="window.addCategory()" class="btn-save">Add</button>
            </div>
        </div>
    </div>

    <!-- BUDGET MODAL -->
    <div id="budget-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üí∏ Budget Limits</h3>
                <span class="material-icons-round close-btn" onclick="window.closeModal('budget-modal')">close</span>
            </div>
            <p class="info-text">Set monthly spending limit per category.</p>
            <select id="budget-cat-select"></select>
            <input type="number" id="budget-limit-amount" placeholder="Monthly limit (‚Çπ)" min="1">
            <div id="existing-budgets" class="existing-budgets"></div>
            <div class="modal-actions">
                <button onclick="window.closeModal('budget-modal')" class="btn-cancel">Close</button>
                <button onclick="window.saveBudget()" class="btn-save">Set Limit</button>
            </div>
        </div>
    </div>

    <!-- PASSWORD MODAL -->
    <div id="password-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üîê Security Check</h3>
                <span class="material-icons-round close-btn" onclick="window.closeModal('password-modal')">close</span>
            </div>
            <p class="info-text" id="password-modal-msg">This action is password protected.</p>
            <div class="password-input-wrap">
                <input type="password" id="password-input" placeholder="Enter password" maxlength="20"
                    onkeydown="if(event.key==='Enter') window.verifyPassword()">
                <span class="material-icons-round toggle-pass" onclick="window.togglePassVisibility()">visibility</span>
            </div>
            <p id="password-error" class="password-error hidden">‚ùå Wrong password! Try again.</p>
            <div class="modal-actions">
                <button onclick="window.closeModal('password-modal')" class="btn-cancel">Cancel</button>
                <button onclick="window.verifyPassword()" class="btn-save">Confirm</button>
            </div>
        </div>
    </div>

    <!-- SET PASSWORD MODAL -->
    <div id="set-password-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üîê Set Security Password</h3>
            </div>
            <p class="info-text">Set a password to protect wallet edits and lock money settings.</p>
            <input type="password" id="set-pass-1" placeholder="New Password" maxlength="20">
            <input type="password" id="set-pass-2" placeholder="Confirm Password" maxlength="20">
            <p id="set-pass-error" class="password-error hidden">‚ùå Passwords don't match!</p>
            <div class="modal-actions">
                <button onclick="window.saveNewPassword()" class="btn-save" style="flex:1">Set Password</button>
            </div>
        </div>
    </div>

    <!-- SETTINGS MODAL -->
    <div id="settings-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚öôÔ∏è Settings</h3>
                <span class="material-icons-round close-btn" onclick="window.closeModal('settings-modal')">close</span>
            </div>
            <div class="settings-list">
                <div class="settings-item" onclick="window.promptPassword('budget')">
                    <span class="material-icons-round">savings</span>
                    <span>Budget Limits</span>
                    <span class="material-icons-round arrow">chevron_right</span>
                </div>
                <div class="settings-item" onclick="window.promptPassword('change-password')">
                    <span class="material-icons-round">lock_reset</span>
                    <span>Change Password</span>
                    <span class="material-icons-round arrow">chevron_right</span>
                </div>
                <div class="settings-item" onclick="window.exportData()">
                    <span class="material-icons-round">download</span>
                    <span>Export CSV</span>
                    <span class="material-icons-round arrow">chevron_right</span>
                </div>
            </div>
        </div>
    </div>

    <div id="toast" class="toast"></div>
    <script type="module" src="script.js"></script>
</body>
</html>
